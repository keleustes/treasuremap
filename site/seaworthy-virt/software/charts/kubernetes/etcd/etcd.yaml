---
apiVersion: armada.airshipit.org/v1alpha1
kind: ArmadaChart
metadata:
  layeringDefinition:
    abstract: false
    actions:
    - method: merge
      path: .
    layer: site
    parentSelector:
      name: kubernetes-etcd-global
  name: kubernetes-etcd
  substitutions:
  - dest:
      path: .values.nodes[0].name
    src:
      kind: PeglegCommonAddresses
      name: common-addresses
      path: .genesis.hostname
  - dest:
      path: .values.nodes[1].name
    src:
      kind: PeglegCommonAddresses
      name: common-addresses
      path: .masters[0].hostname
  - dest:
      path: .values.nodes[2].name
    src:
      kind: PeglegCommonAddresses
      name: common-addresses
      path: .masters[1].hostname
  - dest:
      path: .values.nodes[3].name
    src:
      kind: PeglegCommonAddresses
      name: common-addresses
      path: .masters[2].hostname
  - dest:
      path: .values.nodes[0].tls.client.cert
    src:
      kind: DeckhandCertificate
      name: kubernetes-etcd-genesis
      path: .
  - dest:
      path: .values.nodes[0].tls.client.key
    src:
      kind: DeckhandCertificateKey
      name: kubernetes-etcd-genesis
      path: .
  - dest:
      path: .values.nodes[0].tls.peer.cert
    src:
      kind: DeckhandCertificate
      name: kubernetes-etcd-genesis-peer
      path: .
  - dest:
      path: .values.nodes[0].tls.peer.key
    src:
      kind: DeckhandCertificateKey
      name: kubernetes-etcd-genesis-peer
      path: .
  - dest:
      path: .values.nodes[1].tls.client.cert
    src:
      kind: DeckhandCertificate
      name: kubernetes-etcd-n1
      path: .
  - dest:
      path: .values.nodes[1].tls.client.key
    src:
      kind: DeckhandCertificateKey
      name: kubernetes-etcd-n1
      path: .
  - dest:
      path: .values.nodes[1].tls.peer.cert
    src:
      kind: DeckhandCertificate
      name: kubernetes-etcd-n1-peer
      path: .
  - dest:
      path: .values.nodes[1].tls.peer.key
    src:
      kind: DeckhandCertificateKey
      name: kubernetes-etcd-n1-peer
      path: .
  - dest:
      path: .values.nodes[2].tls.client.cert
    src:
      kind: DeckhandCertificate
      name: kubernetes-etcd-n2
      path: .
  - dest:
      path: .values.nodes[2].tls.client.key
    src:
      kind: DeckhandCertificateKey
      name: kubernetes-etcd-n2
      path: .
  - dest:
      path: .values.nodes[2].tls.peer.cert
    src:
      kind: DeckhandCertificate
      name: kubernetes-etcd-n2-peer
      path: .
  - dest:
      path: .values.nodes[2].tls.peer.key
    src:
      kind: DeckhandCertificateKey
      name: kubernetes-etcd-n2-peer
      path: $
  - dest:
      path: .values.nodes[3].tls.client.cert
    src:
      kind: DeckhandCertificate
      name: kubernetes-etcd-n3
      path: .
  - dest:
      path: .values.nodes[3].tls.client.key
    src:
      kind: DeckhandCertificateKey
      name: kubernetes-etcd-n3
      path: .
  - dest:
      path: .values.nodes[3].tls.peer.cert
    src:
      kind: DeckhandCertificate
      name: kubernetes-etcd-n3-peer
      path: .
  - dest:
      path: .values.nodes[3].tls.peer.key
    src:
      kind: DeckhandCertificateKey
      name: kubernetes-etcd-n3-peer
      path: $
spec: {}
